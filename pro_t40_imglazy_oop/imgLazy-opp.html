<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        ul,
        li {
            list-style: none;
        }
        
        .wrap {
            min-height: 700px;
            overflow: hidden;
        }
        
        .container {
            width: 900px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            overflow-y: auto;
        }
        
        li {
            margin: 10px 10px;
        }
        
        li a img {
            width: 360px;
            height: 270px;
        }
        
        .al {
            width: 1080px;
            margin: 0 auto 100px auto;
            border: 1px solid red;
            /* text-align: center; */
            /* margin-bottom: 100px; */
        }
    </style>
</head>

<body>
    <div class="al">
        <p id="hello">hello</p>
        <p id="world">world</p>
    </div>

    <div class="wrap">
        <ul class="container">
            <li>
                <a href="#"><img src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a>
            </li>
            <li>
                <a href="#"><img src="http://kejian.jirengu.com/data/fe/%E8%AF%BE%E4%BB%B6/32-%E6%87%92%E5%8A%A0%E8%BD%BD/code/blank.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a>
            </li>
        </ul>
    </div>



    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script>
        function Exposure($target, once_check, callback) {
            this.$target = $target;
            this.once_check = once_check;
            this.callback = callback;
            this.loaded = false;
            this.bind();
            this.check();
        }

        Exposure.prototype.bind = function() {
            var _this = this;
            var clock;
            $(window).on('scroll', function() {
                if (clock) {
                    clearTimeout(clock)
                }

                clock = setTimeout(function() {
                    // console.log('111')
                    _this.check();
                }, 100)
            })
        }

        Exposure.prototype.check = function() {
            if (this.once_check) {
                if ((this.isVisible(this.$target)) && (!this.isLoaded(this.$target))) {
                    this.callback(this.$target);
                }

            } else {
                if (this.isVisible(this.$target)) {
                    this.callback(this.$target)
                }
            }
        }

        Exposure.prototype.isVisible = function($node) {
            var windowHeight = $(window).height();
            var offsetTop = $node.offset().top;
            var nodeHeight = $node.height();
            var scrollTop = $(window).scrollTop();
            if (windowHeight + scrollTop > offsetTop + nodeHeight && scrollTop < offsetTop + nodeHeight) {
                return true
            }

            return false
        }

        Exposure.prototype.isLoaded = function($node) {
            if ($node.attr('loaded')) {
                return true;
            } else {
                $node.attr('loaded', 'true');
                return false;
            }
        }


        function showImg($node) {
            console.log("load-img-go");
            $node.attr('src', $node.attr('data-src'))
        }
        // new Exposure($('#hello'), false, function($node) {
        //     $node.text($node.text() + "123");
        // })

        var Lazy = (function() {
            return {
                realTime: function($targets, callback) {
                    $targets.each(function(idx, target) {
                        new Exposure($(target), false, callback);
                    })
                },

                once: function($targets, callback) {
                    $targets.each(function(idx, target) {
                        new Exposure($(target), true, callback);
                    })
                }
            }
        })()

        Lazy.realTime($('#hello'), function($node) {
            $node.text($node.text() + '123');
        });
        Lazy.realTime($('#world'), function($node) {
            $node.text($node.text() + '456');
        });
        Lazy.once($('.container img'), function($node) {
            showImg($node);
        });
    </script>

</body>

</html>